#!/usr/bin/perl -w
#-------------------------------------------------------------------------------------------
# $Id$
#-------------------------------------------------------------------------------------------

#-------------------------------------------------------------------------------------------
#-------------------------------------------------------------------------------------------
# GESTION DE PROCESOS DE SISTEMA
#-------------------------------------------------------------------------------------------
#-------------------------------------------------------------------------------------------
my @res=`/bin/ps -eo pid,args`;
#30142 /usr/local/http/bin/httpd -k start
my %PID=();
my %FD=();

foreach my $k (@res) {
	chomp $k;

	if ( 	($k=~/(\d+)\s+.*?(syslog-ng)/) ||
			($k=~/(\d+)\s+.*?(httpd)/) ||
			($k=~/(\d+)\s+.*?(mysql)/) ||
			($k=~/(\d+)\s+.*?(notificationsd\.900)/) ||
			($k=~/(\d+)\s+.*?(notificationsd\.60)/) ||
			($k=~/(\d+)\s+.*?(crawler)/) ||
			($k=~/(\d+)\s+.*?(actionsd)/) ||
			($k=~/(\d+)\s+.*?(snmpd)/) ||
			($k=~/(\d+)\s+.*?(snmptrapd)/) )  {


#		my @p=split(/\s+/,$k);
		my $pid=$1;
		$PID{$pid} = $2;
	

		my $cmd="/bin/ls -ltr /proc/$pid/fd/ | /usr/bin/wc -l";	
		my $n=`$cmd`;
		$FD{$pid} = chomp $n;

		print "N=$n >> $PID{$pid}\n";

	}
}
